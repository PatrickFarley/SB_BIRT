<!DOCTYPE html>
<html>
<head>

<!-- JQuery -->
<script src="../../Libraries/jQuery/jquery-3.1.1.js"></script>
<script src="../../Libraries/jQuery/jquery-ui-1.12.js"></script>
<script src="../../Libraries/jQuery/jquery.cookie.js"></script>
<link type="text/css" rel="stylesheet"
  href="../../Libraries/jQuery/jquery-ui.css" />
<link type="text/css" rel="stylesheet"
  href="../../Libraries/jQuery/jquery-ui.structure.css" />
<link type="text/css" rel="stylesheet"
  href="../../Libraries/jQuery/jquery-ui.theme.css" />

<link type="text/css" rel="stylesheet" href="../../../Shared/irt.css" />

<!-- JSGrid -->
<link type="text/css" rel="stylesheet"
  href="../../Libraries/jQuery/jsgrid/jsgrid.min.css" />
<link type="text/css" rel="stylesheet"
  href="../../Libraries/jQuery/jsgrid/jsgrid-theme.min.css" />
<script type="text/javascript"
  src="../../Libraries/jQuery/jsgrid/jsgrid.min.js"></script>

 
    
  <script type="text/javascript"
  src="irtspec.js"></script>
<script type="text/javascript" src="populateGrid.js"></script>

<script type="text/javascript">

  $(document).ready(function() {
    
    var reportId =  $.cookie("reportId");
    
    
    $.getJSON(getContextPath()+'/report/getReport/'+reportId, function(data) {
      if(data.success == true){
        console.log(data.reportData);      
        populateReportData(data);
      }else{
        showReportIdDialog(data.message,reportId);
      }
      
    })
      .done(function() {
        console.log( "Report Populate Done" );
      })
      .fail(function(data) {
        showReportIdDialog(data.message,reportId);
      });
    
  
    $("#irtHome").click(function() {
      window.location.href = getContextPath();
    });

  });
  
  function populateReportData(data){
    var reportGridKeys = Object.keys(data.reportData);
    var extReport = false;
    var jsonObject = null;
    reportGridKeys.forEach(function(item, index, array) {
      
      if(item == "externalReportConfig"){
       jsonObject = JSON.parse(data.reportData.externalReportConfig);
      }
      
     
      if(item != "externalReportConfig" && item.startsWith("js")){
        extReport = eval('jsonObject.'+ item);
        populateResults($("#" + item), JSON.parse(eval('data.reportData.' + item)), extReport);
      }
      
      if(item == "headerHTML"){
        var headerJsonObject = JSON.parse(data.reportData.headerHTML);
        Object.keys(headerJsonObject).forEach(function(htmlItem, htmlIndex, htmlArray) {
          
          $("#" + htmlItem).html(eval('headerJsonObject.' + htmlItem));
        });
      }
      
    });
  }
  
  function getContextPath() {
    return window.location.pathname.substring(0, window.location.pathname
        .indexOf("/", 2));
  }
  
  function showReportIdDialog(textInfo, reportId) {

    var id = $('#reportInfoDialog');

    id
        .html('<p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>'
            + textInfo + '</p>');

    id.dialog({
      resizable : false,
      height : "auto",
      title : 'IRT Result Error',
      width : 400,
      modal : true,
      buttons : [ {
        text : "OK",
        click : function() {
          window.location.href = getContextPath();
          $(this).dialog("close");
        }
      } ]
    });
  }

</script>

</head>

<body>
  <div id="report-main">
    <div>

      <h1 class="entry-title">
        <img alt="Smarter Balanced Assessment Consortium"
          style="width: 183px !important; float: lef"
          src="../../../Shared/images/SmarterBalanced_logo.png" /> <span>
          &nbsp;&nbsp;Secure Browser Implementation Readiness Test (IRT)
          Report </span>
      </h1>
      <p align="right">
        <a href="#" id="irtHome">Home</a>
        <span>|</span>
        <a href="javascript:location.reload(true);">Reload</a>
      </p>
    </div>

    <div class="header-irt" id="browserAPI">Browser API</div>
    <div id="jsGrid"></div>




    <div>&nbsp;</div>
    <div>&nbsp;</div>
    <div class="header-irt" id="textToSpeechAPI">Text-to-speech</div>
    <div id="jsTTSGrid"></div>


    <div>&nbsp;</div>
    <div>&nbsp;</div>
    <div id="html5TestMain">
      <div class="header-ext" id="html5TestHeader">HTML5 Test</div>
      <div id="jsHTML5TestGrid"></div>
    </div>


    <div>&nbsp;</div>
    <div>&nbsp;</div>
    <div id="css3TestMain">
      <div class="header-ext" id="css3TestHeader">CSS3 Test</div>
      <div id="jsCSS3TestGrid"></div>
    </div>


    <div id="reportInfoDialog"></div>

  </div>
</body>
</html>